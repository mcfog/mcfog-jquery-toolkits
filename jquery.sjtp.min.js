/**
 * Simple Javascript Template Parser
 * @author McFog <mcfogW@gmail.com>
 * @license MIT License
 * 
 * Include
 * Cross-Browser Split 1.0.1
 * (c) Steven Levithan <stevenlevithan.com>; MIT License
 * An ECMA-compliant, uniform cross-browser split method
 */
;(function($){var j;if(!j){j=function(a,b,c){if(Object.prototype.toString.call(b)!=="[object RegExp]"){return j._nativeSplit.call(a,b,c)}var d=[],lastLastIndex=0,flags=(b.ignoreCase?"i":"")+(b.multiline?"m":"")+(b.sticky?"y":""),b=RegExp(b.source,flags+"g"),separator2,match,lastIndex,lastLength;a=a+"";if(!j._compliantExecNpcg){separator2=RegExp("^"+b.source+"$(?!\\s)",flags)}if(c===undefined||+c<0){c=Infinity}else{c=Math.floor(+c);if(!c){return[]}}while(match=b.exec(a)){lastIndex=match.index+match[0].length;if(lastIndex>lastLastIndex){d.push(a.slice(lastLastIndex,match.index));if(!j._compliantExecNpcg&&match.length>1){match[0].replace(separator2,function(){for(var i=1;i<arguments.length-2;i++){if(arguments[i]===undefined){match[i]=undefined}}})}if(match.length>1&&match.index<a.length){Array.prototype.push.apply(d,match.slice(1))}lastLength=match[0].length;lastLastIndex=lastIndex;if(d.length>=c){break}}if(b.lastIndex===match.index){b.lastIndex++}}if(lastLastIndex===a.length){if(lastLength||!b.test("")){d.push("")}}else{d.push(a.slice(lastLastIndex))}return d.length>c?d.slice(0,c):d};j._compliantExecNpcg=/()??/.exec("")[1]===undefined;j._nativeSplit=String.prototype.split}String.prototype.split=function(a,b){return j(this,a,b)};var k={'render':function(a,b,c){var d=k._$(this);return d.html(k.make.call(a,b,d,c||{}))},'make':function(a,b,c){if('undefined'==typeof b)b=$(document.body);var d=k.parse(this,c||{});if(false==d)return false;try{var f=d.call(b,a)}catch(e){k.log('template make error.');k.log(e)}return f?f:false},'parse':function(a,b){if('string'!==typeof a){a=$(a).html()}b=$.extend({tagRE:/(<<([\s\S]+?)>>)/},b||{});var c=a.split(b.tagRE);var d=['var $container=this,htm=[],echo=function(){htm.push.apply(htm, arguments)};with(context){'];var f=0,_loop=0,curTag=[];while(c.length>0){var g=c.shift();if(g.length==0)continue;if(b.tagRE.test(g)){g=c.shift();var t=g.substr(0,1);if(t==':'){var h=g.substr(1);d.push('echo('+h+');');continue}else if(t=='~'){var h=g.substr(1);d.push(h+';');continue}var i=new RegExp('^\\s*?([/\\w]+)(?:\\s+(.*))?$','g');var h=i.exec(g);switch(h[1]){case'if':f+=1;curTag.unshift('if');d.push('if('+h[2]+'){');break;case'elif':d.push('}else if('+h[2]+'){');break;case'else':switch(curTag[0]){case'if':d.push('}else{');break;default:return false}break;case'/if':f-=1;if(f<0)return false;if('if'!=curTag.shift())return false;d.push('}');break;case'loop':_loop+=1;curTag.unshift('loop');h=h[2].split(/\s+/);if(h.length<2){return false}else if(h.length==2){d.push('for(k in '+h[0]+') {if(!'+h[0]+'.hasOwnProperty(k))continue;var '+h[1]+'='+h[0]+'[k];')}else if(h.length==3){d.push('for('+h[1]+' in '+h[0]+') {if(!'+h[0]+'.hasOwnProperty('+h[1]+'))continue;var '+h[2]+'='+h[0]+'['+h[1]+'];')}else{return false}break;case'/loop':_loop-=1;if('loop'!=curTag.shift())return false;if(_loop<0)return false;d.push('}');break;default:return false}}else{d.push('echo("'+g.replace(/\\/g,'\\\\').replace(/"/g,'\\"').replace(/[\r\n]/g,'\\n')+'");')}}d.push('}return htm.join("");');try{return new Function('context',d.join(''))}catch(e){k.log('template parse error.');k.log(d.join(''));return false}},'log':function(a){if('undefined'!=typeof console&&'function'==typeof console.log){console.log(a)}},'_$':function(a){if('function'==typeof a.constructor&&$==a.constructor){return a}else if(a==window){return $(document.body)}else{return $(a)}}};$.fn.render=k.render;$.fn.make=k.make;$.SJTP=k})(jQuery);